<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Nanize ‚Ä¢ Chat</title>

    <!-- Optional CSP. Adjust origins to match your hosting. -->
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self';
               img-src 'self' https: data:;
               style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
               font-src https://fonts.gstatic.com 'self' data:;
               frame-src https://player.vimeo.com;
               script-src 'self' https://cdn.jsdelivr.net https://unpkg.com 'unsafe-inline';
               connect-src 'self';
               media-src 'self' https:;
      "
    />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/static/css/style.css" />
    <!-- Favicon -->
    <link
      rel="icon"
      type="image/png"
      href="{{ url_for('static', filename='images/favicon.png') }}"
    />

    <!-- REQUIRED LIBRARIES FOR RICH OUTPUTS -->
    <!-- Mermaid -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>
      // Strict mode prevents XSS in diagrams
      if (window.mermaid)
        mermaid.initialize({ startOnLoad: false, securityLevel: "strict" });
    </script>

    <!-- Vega + Vega-Lite + Embed -->
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>

    <!-- MathJax -->
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [
            ["$", "$"],
            ["\\(", "\\)"],
          ],
        },
        svg: { fontCache: "global" },
      };
    </script>
    <script
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"
      async
    ></script>

    <!-- Lottie -->
    <script src="https://cdn.jsdelivr.net/npm/lottie-web@5/build/player/lottie.min.js"></script>
  </head>
  <body class="compact">
    <!-- Background -->
    <div id="heroBg" aria-hidden="true">
      <div class="tint"></div>
      <div class="videos">
        <div class="cell">
          <iframe
            id="bgPortrait1"
            src="https://player.vimeo.com/video/956504693?background=1&autoplay=1&muted=1&loop=1&autopause=0&playsinline=1&controls=0&byline=0&title=0"
          ></iframe>
        </div>
        <div class="cell">
          <iframe
            id="bgLandscape"
            src="https://player.vimeo.com/video/955883957?background=1&autoplay=1&muted=1&loop=1&autopause=0&playsinline=1&controls=0&byline=0&title=0"
          ></iframe>
        </div>
        <div class="cell">
          <iframe
            id="bgPortrait2"
            src="https://player.vimeo.com/video/956502376?background=1&autoplay=1&muted=1&loop=1&autopause=0&playsinline=1&controls=0&byline=0&title=0"
          ></iframe>
        </div>
      </div>
    </div>

    <!-- App -->
    <div id="app" class="app">
      <aside class="sidebar" id="sidebar">
        <div class="sidebar-top">
          <div class="brand">
            <button
              class="icon-btn ghost"
              id="sidebarCloseBtn"
              title="Close sidebar"
            >
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                <path
                  d="M15 18l-6-6 6-6"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </button>
            <span class="brand-text">Nanize</span>
          </div>
          <button class="newchat-btn" id="newChatBtn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
              <path
                d="M12 5v14M5 12h14"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
              />
            </svg>
            <span>New chat</span><span class="badge">NEW</span>
          </button>
        </div>
        <div class="sidebar-scroll" id="sidebarScroll">
          <div class="day-group">
            <div class="day-label">Today</div>
            <ul id="todayList" class="thread-list"></ul>
          </div>
          <div class="day-group">
            <div class="day-label">Yesterday</div>
            <ul id="yesterdayList" class="thread-list"></ul>
          </div>
        </div>
        <div class="sidebar-bottom">
          <a class="cta-row" href="#" id="getApp"
            ><span>Get App</span><span class="badge subtle">NEW</span></a
          >
          <a class="profile-row" href="#" id="profileRow"
            ><div class="avatar">B</div>
            <span>My Profile</span></a
          >
        </div>
      </aside>

      <main class="main" id="main">
        <div class="topbar">
          <button class="icon-btn" id="sidebarOpenBtn" title="Open sidebar">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
              <path
                d="M3 6h18M3 12h18M3 18h18"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
              />
            </svg>
          </button>
          <div class="spacer"></div>
          <button class="icon-btn" id="refreshBtn" title="Refresh">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
              <path
                d="M21 12a9 9 0 10-3.5 7.1M21 12v-6m0 6h-6"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
          </button>
        </div>

        <div id="threadTitleChip" class="title-chip hidden">
          Greeting and Offer of Assistance
        </div>

        <section id="hero" class="hero">
          <div class="hero-logo">
            <img src="/static/images/favicon.png" alt="Nanize logo" />
          </div>
          <h1 class="hero-title">Hi, I'm Nanize Assistant.</h1>
          <p class="hero-sub">How can I help you today?</p>
        </section>

        <section id="chat" class="chat hidden">
          <div id="messages" class="messages" aria-live="polite"></div>
        </section>

        <div class="composer" id="composer">
          <div class="composer-inner">
            <textarea
              id="composerInput"
              rows="1"
              placeholder="Message Nanize"
            ></textarea>
            <div class="composer-row">
              <div class="mode-pills">
                <button id="deepthinkBtn" class="pill">
                  <span>DeepThink</span>
                </button>
                <button id="searchBtn" class="pill"><span>Search</span></button>
              </div>
              <div class="composer-actions">
                <label class="icon-btn" title="Add">
                  <input type="file" id="fileInput" hidden />
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                    <path
                      d="M12 5v14M5 12h14"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </label>
                <button
                  class="send-btn"
                  id="sendBtn"
                  title="Send"
                  aria-label="Send"
                >
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <path
                      d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"
                      fill="currentColor"
                    />
                  </svg>
                </button>
              </div>
            </div>
          </div>
        </div>

        <button class="sidebar-fab" id="sidebarOpenFloat" title="Open sidebar">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
            <path
              d="M3 6h18M3 12h18M3 18h18"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
            />
          </svg>
        </button>
      </main>
    </div>

    <!-- Templates -->
    <template id="tpl-assistant">
      <div class="msg-row">
        <div class="msg msg-assistant">
          <div class="msg-head"><div class="avatar ds">DS</div></div>
          <div class="msg-body markdown"></div>
          <div class="msg-tools">
            <button class="icon-btn tool-copy" title="Copy">‚ßâ</button>
            <button class="icon-btn tool-retry" title="Regenerate">‚Üª</button>
            <button class="icon-btn tool-up" title="Good">üëç</button>
            <button class="icon-btn tool-down" title="Bad">üëé</button>
          </div>
        </div>
      </div>
    </template>

    <template id="tpl-user">
      <div class="msg-row right">
        <div class="msg msg-user">
          <div class="msg-body"></div>
          <div class="msg-tools">
            <button class="icon-btn tool-copy" title="Copy">‚ßâ</button>
            <button class="icon-btn tool-edit" title="Edit">‚úé</button>
          </div>
        </div>
      </div>
    </template>

    <!-- Your app code must load AFTER the libraries -->
    <script src="/static/js/app.js"></script>

    <!-- Quick sanity check. Remove in production. -->
    <script>
      console.log(
        "Mermaid:",
        !!window.mermaid,
        "VegaEmbed:",
        !!window.vegaEmbed,
        "MathJax:",
        !!window.MathJax,
        "Lottie:",
        !!window.lottie
      );
    </script>
  </body>
</html>
